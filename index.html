<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>Hoy no se fía, mañana sí - index</title>
  </head>
  <body>
    <div class="container">
      <div class="row align-items-center">
        <div class="col-auto">
          <a href="./index.html">
            <img
              src="https://pm1.narvii.com/7009/c67ac2e265c76bac9ea52fb4764c40d534315a29r1-628-488v2_hq.jpg"
              height="32"
            />
          </a>
        </div>
        <div class="col"></div>
        <div class="col-auto">
          <button
            type="button"
            data-toggle="modal"
            data-target="#modalIniciarSesion"
            class="btn btn-primary btn-sm"
          >
            Iniciar Sesión
          </button>
          <a href="./carro.html" class="btn btn-primary btn-sm">Carrito</a>
        </div>
      </div>
    </div>
    <div class="container">
      <nav class="navbar navbar-expand navbar-light bg-light">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="./index.html"
              >
                Inicio
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
              >
                Categorías
              </a>
              <ul id="categoriasDD" class="dropdown-menu"></ul>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="./contacto.html"
                tabindex="-1"
                aria-disabled="true"
              >
                Contáctenos
              </a>
            </li>
          </ul>
          <div class="col"></div>
          <form id="buscarForm" class="d-flex">
            <input
              id="buscar"
              size="30"
              class="form-control me-2"
              type="search"
              placeholder="Buscar (minimo 3 caracteres)"
              aria-label="Search"
            />
            <button class="btn btn-outline-success" type="submit">
              Buscar
            </button>
          </form>
        </div>
      </nav>
    </div>

    <section>
      <div class="container">
        <div class="row align-items-center justify-content-center">
          <div class="col-auto h1">Productos</div>
        </div>
        <div
          id="categorias"
          class="row align-items-center justify-content-start categoria"
        ></div>
      </div>
    </section>

    <div class="modal fade" id="modalIniciarSesion">
      <div class="modal-dialog">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Iniciar Sesion</h4>
            <button type="button" class="close" data-dismiss="modal">×</button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <form id="buscarForm" class="d-flex">
              <div class="container">
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="user" class="form-label">Usuario</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center mb-2">
                  <div class="col-12">
                    <input
                      id="user"
                      placeholder="Usuario"
                      class="form-control"
                    />
                  </div>
                  <div id="errorUser" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="password" class="form-label">
                      Contraseña
                    </label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <input
                      id="password"
                      placeholder="Contraseña"
                      type="password"
                      class="form-control"
                    />
                  </div>
                  <div id="errorPassword" class="col-12 text-danger"></div>
                </div>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success"
              data-dismiss="modal"
              onclick="okIniciarSesion()"
            >
              Ingresar
            </button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">
              Volver
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer bg-light">
      <div class="container mt-3">
        <div class="row align-items-center">
          <div class="col-auto">Menú</div>
          <div class="col-auto">
            <a href="./index.html">Inicio</a>
          </div>
          <div class="col-auto">
            <a href="./contacto.html">Contacto</a>
          </div>
        </div>
        <div id="categoriasFT" class="row align-items-center"></div>
        <div class="row align-items-center justify-content-end">
          <div class="col-auto">Talca, Chile Copyright 2021</div>
        </div>
      </div>
    </footer>

    <script>
      const categorias = [
        { id: "vestuario mujer", texto: "Vestuario Mujer" },
        { id: "vestuario hombre", texto: "Vestuario Hombre" },
        { id: "vestuario infantil", texto: "Vestuario Infantil" },
        { id: "tecnologia", texto: "Tecnologia" },
        { id: "hogar", texto: "Hogar" },
        { id: "mascotas", texto: "Mascotas" },
      ];

      const productos = {
        "01": {
          id: "01",
          nombre: "producto 01",
          precio: 1000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 99,
        },
        "02": {
          id: "02",
          nombre: "producto 02",
          precio: 2000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 98,
        },
        "03": {
          id: "03",
          nombre: "producto 03",
          precio: 3000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 97,
        },
        "04": {
          id: "04",
          nombre: "producto 04",
          precio: 4000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 96,
        },
        "05": {
          id: "05",
          nombre: "producto 05",
          precio: 5000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 95,
        },
        "06": {
          id: "06",
          nombre: "producto 06",
          precio: 6000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 94,
        },
        "07": {
          id: "07",
          nombre: "producto 07",
          precio: 7000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 93,
        },
        "08": {
          id: "08",
          nombre: "producto 08",
          precio: 8000,
          categoria: "vestuario infantil",
          marca: "infantil",
          talla: "12",
          descripcion: "vestuario infantil",
          stock: 92,
        },
        "09": {
          id: "09",
          nombre: "producto 09",
          precio: 9000,
          categoria: "vestuario infantil",
          marca: "infantil",
          talla: "12",
          descripcion: "vestuario infantil",
          stock: 91,
        },
        10: {
          id: "10",
          nombre: "producto 10",
          precio: 10000,
          categoria: "tecnologia",
          marca: "tecnologia",
          descripcion: "tecnologia",
          stock: 90,
        },
        11: {
          id: "11",
          nombre: "producto 11",
          precio: 11000,
          categoria: "hogar",
          marca: "hogar",
          descripcion: "hogar",
          stock: 91,
        },
        12: {
          id: "12",
          nombre: "producto 12",
          precio: 12000,
          categoria: "mascotas",
          marca: "mascotas",
          descripcion: "mascotas",
          stock: 91,
        },
      };

      // formulario buscar
      let buscar = "";
      let isBuscarValido = false;

      // formulario iniciar sesion
      let user = "";

      let isUserValido = false;
      let errorUser = [];

      let password = "";

      let isPasswordValido = false;
      let errorPassword = [];

      $(document).ready(function () {
        // campo buscar
        const buscarObj = $("#buscar");
        buscarObj.on("input", () => {
          buscar = buscarObj.val();
          validarBuscar();
          buscarObj.val(buscar);
        });
        const buscarFormObj = $("#buscarForm");
        buscarFormObj.submit((event) => {
          event.preventDefault();
          if (isBuscarValido) {
            window.location.replace("./buscar.html?buscar=" + buscar);
          }
        });

        // campo usuario
        const userObj = $("#user");
        const userError = $("#errorUser");
        userObj.on("input", () => {
          user = userObj.val();
          validarUser();
          userObj.val(user);
          userError.html(errorUser[0] ?? "");
        });
        // campo contraseña
        const passwordObj = $("#password");
        const passwordError = $("#errorPassword");
        passwordObj.on("input", () => {
          password = passwordObj.val();
          validarPassword();
          passwordObj.val(password);
          passwordError.html(errorPassword[0] ?? "");
        });

        // carga categoriasDD
        const categoriasDDObj = $("#categoriasDD");
        let contenidoCategoriaDD = "";
        categorias.forEach((categoria) => {
          contenidoCategoriaDD += `<li>
            <a class="dropdown-item" href="#${categoria.id}">${categoria.texto}</a>
          </li>`;
        });
        categoriasDDObj.html(contenidoCategoriaDD);

        // carga categoriasFT
        const categoriasFTObj = $("#categoriasFT");
        let contenidoCategoriaFT = `<div class="col-auto">Categorías</div>`;
        categorias.forEach((categoria) => {
          contenidoCategoriaFT += `<div class="col-auto">
            <a href="#${categoria.id}">${categoria.texto}</a>
          </div>`;
        });
        categoriasFTObj.html(contenidoCategoriaFT);

        // carga productos
        const productosCategorias = Object.values(productos).reduce(
          (pre, item) => {
            if (!pre[item.categoria]) {
              pre[item.categoria] = [item];
              return pre;
            }
            pre[item.categoria].push(item);
            return pre;
          },
          {}
        );
        const categoriasObj = $("#categorias");
        let contenido = "";
        categorias.forEach((categoria) => {
          contenido += `<div class="col-12">
            <div class="card">
              <div id="${categoria.id}" class="card-header">${categoria.texto}</div>
              <div class="card-body">
                <div class="row align-items-center justify-content-center">`;
          productosCategorias[categoria.id].forEach((producto) => {
            contenido += `<div class="col-3" data-toggle="modal" data-target="#modal${producto.id}">
                    <div
                      class="card"
                      data-toggle="tooltip"
                      data-placement="top"
                      title="precio: $${producto.precio} - stock: ${producto.stock}"
                    >
                      <img
                        width="100%"
                        src="https://previews.123rf.com/images/sugarwarrior/sugarwarrior1602/sugarwarrior160200141/51591850-ropa-de-moda-el-concepto-de-plantilla-infograf%C3%ADa-iconos-del-dise%C3%B1o-de-su-producto-o-dise%C3%B1o-web-y-aplicacione.jpg"
                        class="card-img-top"
                      />
                      <div class="card-body">
                        <h5 class="card-title">${producto.nombre}</h5>
                        <p class="card-text">Precio: $${producto.precio}</p>
                      </div>
                    </div>
                    <div class="modal fade" id="modal${producto.id}">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <!-- Modal Header -->
                          <div class="modal-header">
                            <h4 class="modal-title">${producto.nombre}</h4>
                            <button type="button" class="close" data-dismiss="modal">×</button>
                          </div>

                          <!-- Modal body -->
                          <div class="modal-body">
                            <div class="row align-items-center">`;
            if (producto.marca) {
              contenido += `<div class="col-6">
                          Marca:
                        </div>
                        <div class="col-6">
                          ${producto.marca}
                        </div>`;
            }
            if (producto.talla) {
              contenido += `<div class="col-6">
                          Talla:
                        </div>
                        <div class="col-6">
                          ${producto.talla}
                        </div>`;
            }
            if (producto.descripcion) {
              contenido += `<div class="col-6">
                          Descripcion:
                        </div>
                        <div class="col-6">
                          ${producto.descripcion}
                        </div>`;
            }
            if (producto.stock) {
              contenido += `<div class="col-6">
                          Stock:
                        </div>
                        <div class="col-6">
                          ${producto.stock}
                        </div>`;
            }
            contenido += `</div>
                          </div>

                          <!-- Modal footer -->
                          <div class="modal-footer">
                            <button
                              type="button"
                              class="btn btn-success"
                              data-dismiss="modal"
                              onclick="ok()"
                            >
                              Carrito
                            </button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal">
                              Comprar
                            </button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">
                              Volver
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>`;
          });
          contenido += `</div>
              </div>
            </div>
          </div>`;
        });
        categoriasObj.html(contenido);
      });

      const validarBuscar = () => {
        const regex = RegExp("[^a-zA-Z0-9 ]", "gm");
        const valido = buscar.replace(regex, "");
        buscar = valido;
        isBuscarValido = buscar.length >= 3;
      };

      const validarUser = () => {
        errorUser = [];
        const regex = RegExp("[^a-zA-Z0-9]", "gm");
        const valido = user.replace(regex, "");
        user = valido;
        isUserValido = !!user;
        if (!isUserValido) {
          errorUser.push("el campo no puede estar vacio");
        }
        isUserValido = user.length > 3;
        if (!isUserValido) {
          errorUser.push("el campo tiene que tener mas de 3 caracteres");
        }
      };

      const validarPassword = () => {
        errorPassword = [];
        isPasswordValido = !!password;
        if (!isPasswordValido) {
          errorPassword.push("el campo no puede estar vacio");
        }
        isPasswordValido = password.length >= 6;
        if (!isPasswordValido) {
          errorPassword.push("el campo tiene que tener minimo 6 caracteres");
        }
      };

      const ok = () => {
        alert("Producto Agregado al carrito");
      };

      const okIniciarSesion = () => {
        if (!isUserValido || !isPasswordValido) {
          alert("Llene Correctamente el Formulario");
          return;
        }
      };
    </script>
  </body>
</html>
