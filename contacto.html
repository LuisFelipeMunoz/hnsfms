<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>Hoy no se fía, mañana sí - contacto</title>
  </head>
  <body>
    <div class="container">
      <div class="row align-items-end">
        <div class="col-auto">
          <a href="./index.html">
            <img
              src="https://pm1.narvii.com/7009/c67ac2e265c76bac9ea52fb4764c40d534315a29r1-628-488v2_hq.jpg"
              height="64"
            />
          </a>
        </div>
        <div class="col"></div>
        <div class="col-auto">
          <button
            type="button"
            data-toggle="modal"
            data-target="#modalIniciarSesion"
            class="btn btn-primary btn-sm"
          >
            Iniciar Sesión
          </button>
          <a href="./carro.html" class="btn btn-primary btn-sm">Carrito</a>
        </div>
      </div>
      <nav class="navbar navbar-expand navbar-light bg-light px-0">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="./index.html"
              >
                Inicio
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
              >
                Categorías
              </a>
              <ul id="categoriasDD" class="dropdown-menu"></ul>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="./contacto.html"
                tabindex="-1"
                aria-disabled="true"
              >
                Contáctenos
              </a>
            </li>
          </ul>
          <div class="col"></div>
          <form id="buscarForm" class="d-flex">
            <input
              id="buscar"
              size="30"
              class="form-control me-2"
              type="search"
              placeholder="Buscar (minimo 3 caracteres)"
              aria-label="Search"
            />
            <button class="btn btn-outline-success" type="submit">
              Buscar
            </button>
          </form>
        </div>
      </nav>
    </div>

    <section class="contacto">
      <div class="container">
        <div class="row align-items-center justify-content-center">
          <div class="col-auto h1">Contacto</div>
        </div>
        <div class="row align-items-center justify-content-center">
          <div class="col-12">
            <div class="card">
              <form id="contactoForm" class="container my-2">
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="nombre" class="form-label">Nombre</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <input id="nombre" class="form-control" />
                  </div>
                  <div id="errorNombre" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="correo" class="form-label">Correo</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <input id="correo" class="form-control" />
                  </div>
                  <div id="errorCorreo" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="asunto" class="form-label">Asunto</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <select id="asunto" class="form-control">
                      <option>Seleccione Asunto</option>
                      <option>Solicitar Informacion</option>
                      <option>Reclamo</option>
                    </select>
                  </div>
                  <div id="errorAsunto" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="mensaje" class="form-label">Mensaje</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <textarea id="mensaje" class="form-control"></textarea>
                  </div>
                  <div id="errorMensaje" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="d-grid gap-2 my-2">
                    <button class="btn btn-primary" type="submit">
                      enviar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="modal fade" id="modalIniciarSesion">
      <div class="modal-dialog">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Iniciar Sesion</h4>
            <button type="button" class="close" data-dismiss="modal">×</button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <form id="buscarForm" class="d-flex">
              <div class="container">
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="user" class="form-label">Usuario</label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center mb-2">
                  <div class="col-12">
                    <input
                      id="user"
                      placeholder="Usuario"
                      class="form-control"
                    />
                  </div>
                  <div id="errorUser" class="col-12 text-danger"></div>
                </div>
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="password" class="form-label">
                      Contraseña
                    </label>
                  </div>
                </div>
                <div class="row align-items-center justify-content-center">
                  <div class="col-12">
                    <input
                      id="password"
                      placeholder="Contraseña"
                      type="password"
                      class="form-control"
                    />
                  </div>
                  <div id="errorPassword" class="col-12 text-danger"></div>
                </div>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success"
              data-dismiss="modal"
              onclick="okIniciarSesion()"
            >
              Ingresar
            </button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">
              Volver
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer bg-light">
      <div class="container mt-3">
        <div class="row align-items-center">
          <div class="col-auto">Menú</div>
          <div class="col-auto">
            <a href="./index.html">Inicio</a>
          </div>
          <div class="col-auto">
            <a href="./contacto.html">Contacto</a>
          </div>
        </div>
        <div id="categoriasFT" class="row align-items-center"></div>
        <div class="row align-items-center justify-content-end">
          <div class="col-auto">Talca, Chile Copyright 2021</div>
        </div>
      </div>
    </footer>

    <script>
      const categorias = [
        { id: "vestuario mujer", texto: "Vestuario Mujer" },
        { id: "vestuario hombre", texto: "Vestuario Hombre" },
        { id: "vestuario infantil", texto: "Vestuario Infantil" },
        { id: "tecnologia", texto: "Tecnologia" },
        { id: "hogar", texto: "Hogar" },
        { id: "mascotas", texto: "Mascotas" },
      ];

      const productos = {
        "01": {
          id: "01",
          nombre: "producto 01",
          precio: 1000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 99,
        },
        "02": {
          id: "02",
          nombre: "producto 02",
          precio: 2000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 98,
        },
        "03": {
          id: "03",
          nombre: "producto 03",
          precio: 3000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 97,
        },
        "04": {
          id: "04",
          nombre: "producto 04",
          precio: 4000,
          categoria: "vestuario mujer",
          marca: "mujer",
          talla: "s",
          descripcion: "vestuario mujer",
          stock: 96,
        },
        "05": {
          id: "05",
          nombre: "producto 05",
          precio: 5000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 95,
        },
        "06": {
          id: "06",
          nombre: "producto 06",
          precio: 6000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 94,
        },
        "07": {
          id: "07",
          nombre: "producto 07",
          precio: 7000,
          categoria: "vestuario hombre",
          marca: "hombre",
          talla: "l",
          descripcion: "vestuario hombre",
          stock: 93,
        },
        "08": {
          id: "08",
          nombre: "producto 08",
          precio: 8000,
          categoria: "vestuario infantil",
          marca: "infantil",
          talla: "12",
          descripcion: "vestuario infantil",
          stock: 92,
        },
        "09": {
          id: "09",
          nombre: "producto 09",
          precio: 9000,
          categoria: "vestuario infantil",
          marca: "infantil",
          talla: "12",
          descripcion: "vestuario infantil",
          stock: 91,
        },
        10: {
          id: "10",
          nombre: "producto 10",
          precio: 10000,
          categoria: "tecnologia",
          marca: "tecnologia",
          descripcion: "tecnologia",
          stock: 90,
        },
        11: {
          id: "11",
          nombre: "producto 11",
          precio: 11000,
          categoria: "hogar",
          marca: "hogar",
          descripcion: "hogar",
          stock: 91,
        },
        12: {
          id: "12",
          nombre: "producto 12",
          precio: 12000,
          categoria: "mascotas",
          marca: "mascotas",
          descripcion: "mascotas",
          stock: 91,
        },
      };

      // formulario buscar
      let buscar = "";
      let isBuscarValido = false;

      // formulario iniciar sesion
      let user = "";

      let isUserValido = false;
      let errorUser = [];

      let password = "";

      let isPasswordValido = false;
      let errorPassword = [];

      // formulario contacto
      let nombreObj = null;
      let nombreError = null;
      let nombre = "";

      let isNombreValido = false;
      let errorNombre = [];

      let correoObj = null;
      let correoError = null;
      let correo = "";

      let isCorreoValido = false;
      let errorCorreo = [];

      let asuntoObj = null;
      let asuntoError = null;
      let asunto = "";

      let isAsuntoValido = false;
      let errorAsunto = [];

      let mensajeObj = null;
      let mensajeError = null;
      let mensaje = "";

      let isMensajeValido = false;
      let errorMensaje = [];

      $(document).ready(function () {
        // campo buscar
        const buscarObj = $("#buscar");
        buscarObj.on("input", () => {
          buscar = buscarObj.val();
          validarBuscar();
          buscarObj.val(buscar);
        });
        const buscarFormObj = $("#buscarForm");
        buscarFormObj.submit((event) => {
          event.preventDefault();
          okBuscar();
        });

        // campo usuario
        const userObj = $("#user");
        const userError = $("#errorUser");
        userObj.on("input", () => {
          user = userObj.val();
          validarUser();
          userObj.val(user);
          userError.html(errorUser[0] ?? "");
        });
        // campo contraseña
        const passwordObj = $("#password");
        const passwordError = $("#errorPassword");
        passwordObj.on("input", () => {
          password = passwordObj.val();
          validarPassword();
          passwordObj.val(password);
          passwordError.html(errorPassword[0] ?? "");
        });

        // carga categoriasDD
        const categoriasDDObj = $("#categoriasDD");
        let contenidoCategoriaDD = "";
        categorias.forEach((categoria) => {
          contenidoCategoriaDD += `<li>
            <a class="dropdown-item" href="./index.html#${categoria.id}">${categoria.texto}</a>
          </li>`;
        });
        categoriasDDObj.html(contenidoCategoriaDD);

        // carga categoriasFT
        const categoriasFTObj = $("#categoriasFT");
        let contenidoCategoriaFT = `<div class="col-auto">Categorías</div>`;
        categorias.forEach((categoria) => {
          contenidoCategoriaFT += `<div class="col-auto">
            <a href="./index.html#${categoria.id}">${categoria.texto}</a>
          </div>`;
        });
        categoriasFTObj.html(contenidoCategoriaFT);

        // campo nombre
        nombreObj = $("#nombre");
        nombreError = $("#errorNombre");
        nombreObj.on("input", inputNombre);
        // campo correo
        correoObj = $("#correo");
        correoError = $("#errorCorreo");
        correoObj.on("input", inputCorreo);
        // campo asunto
        asuntoObj = $("#asunto");
        asuntoError = $("#errorAsunto");
        asuntoObj.on("input", inputAsunto);
        // campo mensaje
        mensajeObj = $("#mensaje");
        mensajeError = $("#errorMensaje");
        mensajeObj.on("input", inputMensaje);

        const contactoFormObj = $("#contactoForm");
        contactoFormObj.submit((event) => {
          event.preventDefault();
          okContacto();
        });
      });

      const inputNombre = () => {
        nombre = nombreObj.val();
        validarNombre();
        nombreObj.val(nombre);
        nombreError.html(errorNombre[0] ?? "");
      };

      const inputCorreo = () => {
        correo = correoObj.val();
        validarCorreo();
        correoObj.val(correo);
        correoError.html(errorCorreo[0] ?? "");
      };

      const inputAsunto = () => {
        asunto = asuntoObj.val();
        validarAsunto();
        asuntoObj.val(asunto);
        asuntoError.html(errorAsunto[0] ?? "");
      };

      const inputMensaje = () => {
        mensaje = mensajeObj.val();
        validarMensaje();
        mensajeObj.val(mensaje);
        mensajeError.html(errorMensaje[0] ?? "");
      };

      const validarBuscar = () => {
        const regex = RegExp("[^a-zA-Z0-9 ]", "gm");
        const valido = buscar.replace(regex, "");
        buscar = valido;
        isBuscarValido = buscar.length >= 3;
      };

      const validarUser = () => {
        errorUser = [];
        const regex = RegExp("[^a-zA-Z0-9]", "gm");
        const valido = user.replace(regex, "");
        user = valido;
        isUserValido = !!user;
        if (!isUserValido) {
          errorUser.push("el campo no puede estar vacio");
        }
        isUserValido = user.length > 3;
        if (!isUserValido) {
          errorUser.push("el campo tiene que tener mas de 3 caracteres");
        }
      };

      const validarPassword = () => {
        errorPassword = [];
        isPasswordValido = !!password;
        if (!isPasswordValido) {
          errorPassword.push("el campo no puede estar vacio");
        }
        isPasswordValido = password.length >= 6;
        if (!isPasswordValido) {
          errorPassword.push("el campo tiene que tener minimo 6 caracteres");
        }
      };

      const validarNombre = () => {
        errorNombre = [];
        const regex = RegExp("[^a-zA-Z ]", "gm");
        const valido = nombre.replace(regex, "");
        nombre = valido;
        isNombreValido =
          nombre.split(" ").filter((item) => {
            return !!item;
          }).length >= 3;
        if (!isNombreValido) {
          errorNombre.push("minimo 3 palabras");
        }
      };

      const validarCorreo = () => {
        errorCorreo = [];
        const regex = RegExp("[^a-zA-Z0-9@.]", "gm");
        const valido = correo.replace(regex, "");
        console.log(valido);
        correo = valido;
        const dividido = correo.split("@").filter((item) => {
          return !!item;
        });
        isCorreoValido = !dividido.length === 0;
        if (!isCorreoValido) {
          errorCorreo.push("el campo no puede estar vacio");
          return;
        }
        isCorreoValido = dividido.length === 2;
        if (!isCorreoValido) {
          errorCorreo.push("el correo tiene que contener @");
          return;
        }
        const host = dividido[1].split(".").filter((item) => {
          return !!item;
        });
        isCorreoValido = host.length == 2;
        if (!isCorreoValido) {
          errorCorreo.push(
            "el correo tiene que tener un . antes de la extencion en el host"
          );
          return;
        }
        isCorreoValido = host[1].length <= 3;
        if (!isCorreoValido) {
          errorCorreo.push(
            "la extencion no puede tener mas de tres caracteres"
          );
          return;
        }
      };

      const validarAsunto = () => {
        errorAsunto = [];
        isAsuntoValido = asunto != "Seleccione Asunto";
        if (!isAsuntoValido) {
          errorAsunto.push("seleccione un asunto");
        }
      };

      const validarMensaje = () => {
        errorMensaje = [];
        isMensajeValido =
          mensaje.split(" ").filter((item) => {
            return !!item;
          }).length >= 3;
        if (!isMensajeValido) {
          errorMensaje.push("minimo 3 palabras");
        }
      };

      const ok = () => {
        alert("Producto Agregado al carrito");
      };

      const okIniciarSesion = () => {
        if (!isUserValido || !isPasswordValido) {
          alert("Llene Correctamente el Formulario");
          return;
        }
      };

      const okBuscar = () => {
        if (!isBuscarValido) {
          alert("Minimo 3 caracteres para buscar");
          return;
        }
        window.location.replace("./buscar.html?buscar=" + buscar);
      };

      const okContacto = () => {
        inputNombre();
        inputCorreo();
        inputAsunto();
        inputMensaje();
        if (
          !isNombreValido ||
          !isCorreoValido ||
          !isAsuntoValido ||
          !isMensajeValido
        ) {
          alert("Llene Correctamente el Formulario");
          return;
        }
      };
    </script>
  </body>
</html>
